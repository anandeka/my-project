DROP materialized view MV_BI_DERIVATIVE_JOURNAL_EOD;
DROP table MV_BI_DERIVATIVE_JOURNAL_EOD;
create materialized view MV_BI_DERIVATIVE_JOURNAL_EOD
refresh force on demand
as
select edj.internal_derivative_ref_no,
       edj.journal_type,
       edj.book_type,
       edj.corporate_id,
       edj.corporate_name,
       edj.profit_center_id,
       edj.profit_center_name,
       edj.profit_center_short_name,
       edj.catogery,
       edj.derivative_ref_no,
       edj.clearer,
       edj.clearer_id,
       edj.trader,
       edj.strategy_id,
       edj.strategy_name,
       edj.trade_type,
       edj.trade_date,
       edj.product_id,
       edj.product,
       edj.prompt_date,
       edj.quantity,
       edj.quantity_uom,
       edj.trade_price,
       edj.price_unit,
       edj.strike_price,
       edj.strike_price_unit,
       edj.premium_discount,
       edj.put_call,
       edj.pd_price_unit,
       edj.declaration_date,
       edj.clearer_commission,
       edj.average_premium,
       edj.average_from_date,
       edj.average_to_date,
       edj.price_point_name,
       edj.status,
       edj.attribute_1,
       edj.attribute_2,
       edj.attribute_3,
       edj.attribute_4,
       edj.attribute_5,
       edj.eod_eom_date,
       edj.process,
       edj.process_id,
       edj.dbd_id,
       edj.instrument_id,
       edj.instrument_name,
       edj.instrument_type,
       edj.trade_quantity,
       edj.trade_quantity_unit,
       edj.exercised_expired_lots,
       edj.exercised_expired_quantity,
       edj.ext_trade_ref_no,
       edj.int_trade_ref_no,
       edj.master_cont_ref_no,
       edj.clearer_comm_type,
       edj.clearer_comm_perunit,
       edj.clearer_comm_unit,
       edj.exchange,
       edj.remarks,
       tdc.created_date eod_eom_run_date,
       tdc.process_run_count eod_eom_run_count,
       edj.period_type
  from eod_eom_derivative_journal@eka_eoddb edj,
       tdc_trade_date_closure@eka_eoddb     tdc
 where edj.corporate_id = tdc.corporate_id
   and edj.process_id = tdc.process_id
   and edj.process = 'EOD';
---------
DROP materialized view MV_BI_DERIVATIVE_JOURNAL_EOM;
DROP table MV_BI_DERIVATIVE_JOURNAL_EOM;
create materialized view MV_BI_DERIVATIVE_JOURNAL_EOM
refresh force on demand
as
select edj.internal_derivative_ref_no,
       edj.journal_type,
       edj.book_type,
       edj.corporate_id,
       edj.corporate_name,
       edj.profit_center_id,
       edj.profit_center_name,
       edj.profit_center_short_name,
       edj.catogery,
       edj.derivative_ref_no,
       edj.clearer,
       edj.clearer_id,
       edj.trader,
       edj.strategy_id,
       edj.strategy_name,
       edj.trade_type,
       edj.trade_date,
       edj.product_id,
       edj.product,
       edj.prompt_date,
       edj.quantity,
       edj.quantity_uom,
       edj.trade_price,
       edj.price_unit,
       edj.strike_price,
       edj.strike_price_unit,
       edj.premium_discount,
       edj.put_call,
       edj.pd_price_unit,
       edj.declaration_date,
       edj.clearer_commission,
       edj.average_premium,
       edj.average_from_date,
       edj.average_to_date,
       edj.price_point_name,
       edj.status,
       edj.attribute_1,
       edj.attribute_2,
       edj.attribute_3,
       edj.attribute_4,
       edj.attribute_5,
       edj.eod_eom_date,
       edj.process,
       edj.process_id,
       edj.dbd_id,
       edj.instrument_id,
       edj.instrument_name,
       edj.instrument_type,
       edj.trade_quantity,
       edj.trade_quantity_unit,
       edj.exercised_expired_lots,
       edj.exercised_expired_quantity,
       edj.ext_trade_ref_no,
       edj.int_trade_ref_no,
       edj.master_cont_ref_no,
       edj.clearer_comm_type,
       edj.clearer_comm_perunit,
       edj.clearer_comm_unit,
       edj.exchange,
       edj.remarks,
       tdc.created_date eod_eom_run_date,
       tdc.process_run_count eod_eom_run_count,
       edj.period_type
  from eod_eom_derivative_journal@eka_eoddb edj,
       tdc_trade_date_closure@eka_eoddb     tdc
 where edj.corporate_id = tdc.corporate_id
   and edj.process_id = tdc.process_id
   and edj.process = 'EOM';

DROP materialized view MV_BI_PHYSICAL_RISK_POS_EOD;
DROP table MV_BI_PHYSICAL_RISK_POS_EOD;
create materialized view MV_BI_PHYSICAL_RISK_POS_EOD
refresh force on demand
as
select prp.profit_center_id,
       prp.profit_center_name,
       prp.profit_center_short_name,
       prp.del_from_date,
       prp.del_to_date,
       prp.cp_id,
       prp.counter_party,
       prp.product_id,
       prp.product_name,
       prp.di_item_ref_no,
       prp.trade_type,
       prp.del_item_qty,
       prp.priced_qty,
       prp.priced_qty_unit_id,
       prp.price_qty_unit,
       prp.di_price,
       prp.di_price_unit_id,
      -- prp.di_price_unit_id,
       prp.di_price_unit,
       prp.contract_premium,
       prp.contract_premium_unit_id,
       prp.contract_premium_unit,
       prp.market_price,
       prp.market_price_unit_id,
       prp.market_price_unit,
       prp.market_premium,
       prp.market_premium_cur_id,
       prp.market_premium_ccy,
       prp.total_amount,
       prp.total_amount_cur_id,
       prp.total_amount_cur_code,
       prp.fx_rate,
       prp.total_in_base_ccy,
    --   prp.product_name,
       prp.stock_location,
       prp.duty_status,
       prp.corporate_id,
       prp.corporate,
       tdc.TRADE_DATE eod_eom_date,
       prp.product_group,
       tdc.process,
       tdc.created_date eod_eom_run_date,
       tdc.process_run_count eod_eom_run_count,
       to_char(prp.delivery_to_date,'Mon') delivery_month,
       to_char(prp.delivery_to_date,'yyyy')delivery_year
       
from prp_physical_risk_position@eka_eoddb prp,
       tdc_trade_date_closure@eka_eoddb  tdc
 where prp.corporate_id = tdc.corporate_id
   and prp.process_id = tdc.process_id
   and prp.process = 'EOD';

DROP materialized view MV_BI_PHYSICAL_RISK_POS_EOM;
DROP table MV_BI_PHYSICAL_RISK_POS_EOM;
create materialized view MV_BI_PHYSICAL_RISK_POS_EOM
refresh force on demand
as
select prp.profit_center_id,
       prp.profit_center_name,
       prp.profit_center_short_name,
       prp.del_from_date,
       prp.del_to_date,
       prp.cp_id,
       prp.counter_party,
       prp.product_id,
       prp.product_name,
       prp.di_item_ref_no,
       prp.trade_type,
       prp.del_item_qty,
       prp.priced_qty,
       prp.priced_qty_unit_id,
       prp.price_qty_unit,
       prp.di_price,
       prp.di_price_unit_id,
      -- prp.di_price_unit_id,
       prp.di_price_unit,
       prp.contract_premium,
       prp.contract_premium_unit_id,
       prp.contract_premium_unit,
       prp.market_price,
       prp.market_price_unit_id,
       prp.market_price_unit,
       prp.market_premium,
       prp.market_premium_cur_id,
       prp.market_premium_ccy,
       prp.total_amount,
       prp.total_amount_cur_id,
       prp.total_amount_cur_code,
       prp.fx_rate,
       prp.total_in_base_ccy,
    --   prp.product_name,
       prp.stock_location,
       prp.duty_status,
       prp.corporate_id,
       prp.corporate,
       tdc.TRADE_DATE eod_eom_date,
       prp.product_group,
       tdc.process,
       tdc.created_date eod_eom_run_date,
       tdc.process_run_count eod_eom_run_count,
       to_char(prp.delivery_to_date,'Mon') delivery_month,
       to_char(prp.delivery_to_date,'yyyy')delivery_year
       
from prp_physical_risk_position@eka_eoddb prp,
       tdc_trade_date_closure@eka_eoddb  tdc
 where prp.corporate_id = tdc.corporate_id
   and prp.process_id = tdc.process_id
   and prp.process = 'EOM';